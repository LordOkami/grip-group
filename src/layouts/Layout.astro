---
import '../styles/global.css';
import { getLangFromUrl, useTranslations, useTranslatedPath } from '../i18n/utils';

interface Props {
  title: string;
  description?: string;
  currentPage?: string;
}

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);
const translatePath = useTranslatedPath(lang);

const {
  title,
  description = lang === 'es'
    ? "Grip Club - Carrera de Resistencia 8 Horas en motos 125cc de serie. La experiencia definitiva del motorsport amateur."
    : "Grip Club - 8 Hours Endurance Race on stock 125cc motorcycles. The ultimate amateur motorsport experience.",
  currentPage = "historia"
} = Astro.props;

const altLang = lang === 'es' ? 'en' : 'es';
const altPath = lang === 'es'
  ? `/en${Astro.url.pathname}`
  : Astro.url.pathname.replace('/en', '') || '/';
---

<!DOCTYPE html>
<html lang={lang}>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content={description} />
    <meta name="keywords" content="motos, 125cc, resistencia, endurance, carrera, motorsport, Grip Club, España" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <link rel="alternate" hreflang="es" href={`https://gripclub.es${Astro.url.pathname.replace('/en', '') || '/'}`} />
    <link rel="alternate" hreflang="en" href={`https://gripclub.es/en${Astro.url.pathname.replace('/en', '')}`} />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <title>{title} | Grip Club</title>
  </head>
  <body class="min-h-screen flex flex-col">
    <!-- Header / Navigation -->
    <header class="fixed top-0 left-0 right-0 z-50 bg-racing-black/90 backdrop-blur-md border-b border-racing-silver/10">
      <nav class="container mx-auto px-4 md:px-8">
        <div class="flex items-center justify-between h-20">
          <!-- Logo -->
          <a href={translatePath('/')} class="flex items-center gap-3 group">
            <div class="w-12 h-12 bg-racing-green rounded-lg flex items-center justify-center group-hover:bg-racing-green-dark transition-colors">
              <svg class="w-8 h-8 text-white" fill="currentColor" viewBox="0 0 24 24">
                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.94-.49-7-3.85-7-7.93s3.05-7.44 7-7.93v15.86zm2-15.86c3.94.49 7 3.85 7 7.93s-3.05 7.44-7 7.93V4.07z"/>
              </svg>
            </div>
            <div class="hidden sm:block">
              <span class="text-2xl font-bold tracking-wider" style="font-family: 'Bebas Neue', sans-serif;">GRIP CLUB</span>
              <span class="block text-xs text-racing-silver tracking-widest">8H ENDURANCE</span>
            </div>
          </a>

          <!-- Desktop Navigation -->
          <div class="hidden md:flex items-center gap-8">
            <a href={translatePath('/')} class={`nav-link ${currentPage === 'historia' ? 'active' : ''}`}>{t('nav.historia')}</a>
            <a href={translatePath('/motos')} class={`nav-link ${currentPage === 'motos' ? 'active' : ''}`}>{t('nav.motos')}</a>
            <a href={translatePath('/inscripciones')} class={`nav-link ${currentPage === 'inscripciones' ? 'active' : ''}`}>{t('nav.inscripciones')}</a>

            <!-- Language Switcher -->
            <a href={altPath} class="nav-link flex items-center gap-1 text-sm">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 01-9 9m9-9a9 9 0 00-9-9m9 9H3m9 9a9 9 0 01-9-9m9 9c1.657 0 3-4.03 3-9s-1.343-9-3-9m0 18c-1.657 0-3-4.03-3-9s1.343-9 3-9m-9 9a9 9 0 019-9"/>
              </svg>
              {t('lang.switch')}
            </a>
          </div>

          <!-- CTA Button Desktop -->
          <a href={translatePath('/inscripciones#registro')} class="hidden md:inline-block btn-primary">
            {t('nav.cta')}
          </a>

          <!-- Mobile Menu Button -->
          <button id="mobile-menu-btn" class="md:hidden text-white p-2" aria-label="Abrir menú">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
            </svg>
          </button>
        </div>

        <!-- Mobile Navigation -->
        <div id="mobile-menu" class="md:hidden hidden pb-6">
          <div class="flex flex-col gap-4 pt-4 border-t border-racing-silver/10">
            <a href={translatePath('/')} class={`nav-link ${currentPage === 'historia' ? 'active' : ''}`}>{t('nav.historia')}</a>
            <a href={translatePath('/motos')} class={`nav-link ${currentPage === 'motos' ? 'active' : ''}`}>{t('nav.motos')}</a>
            <a href={translatePath('/inscripciones')} class={`nav-link ${currentPage === 'inscripciones' ? 'active' : ''}`}>{t('nav.inscripciones')}</a>
            <a href={altPath} class="nav-link flex items-center gap-2">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 01-9 9m9-9a9 9 0 00-9-9m9 9H3m9 9a9 9 0 01-9-9m9 9c1.657 0 3-4.03 3-9s-1.343-9-3-9m0 18c-1.657 0-3-4.03-3-9s1.343-9 3-9m-9 9a9 9 0 019-9"/>
              </svg>
              {t('lang.switch')}
            </a>
            <a href={translatePath('/inscripciones#registro')} class="btn-primary text-center mt-4">{t('nav.cta')}</a>
          </div>
        </div>
      </nav>
    </header>

    <!-- Main Content -->
    <main class="flex-grow pt-20">
      <slot />
    </main>

    <!-- Footer -->
    <footer class="bg-racing-gray border-t border-racing-silver/10">
      <div class="container mx-auto px-4 md:px-8 py-12">
        <div class="grid grid-cols-1 md:grid-cols-3 gap-8 mb-8">
          <!-- Brand -->
          <div>
            <div class="flex items-center gap-3 mb-4">
              <div class="w-10 h-10 bg-racing-green rounded-lg flex items-center justify-center">
                <svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 24 24">
                  <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.94-.49-7-3.85-7-7.93s3.05-7.44 7-7.93v15.86zm2-15.86c3.94.49 7 3.85 7 7.93s-3.05 7.44-7 7.93V4.07z"/>
                </svg>
              </div>
              <span class="text-xl font-bold tracking-wider" style="font-family: 'Bebas Neue', sans-serif;">GRIP CLUB</span>
            </div>
            <p class="text-racing-silver text-sm">
              {t('footer.description')}
            </p>
          </div>

          <!-- Quick Links -->
          <div>
            <h4 class="text-white font-bold mb-4 uppercase tracking-wider">{t('footer.links')}</h4>
            <ul class="space-y-2">
              <li><a href={translatePath('/')} class="text-racing-silver hover:text-vanilla transition-colors">{t('nav.historia')}</a></li>
              <li><a href={translatePath('/motos')} class="text-racing-silver hover:text-vanilla transition-colors">{t('nav.motos')}</a></li>
              <li><a href={translatePath('/inscripciones')} class="text-racing-silver hover:text-vanilla transition-colors">{t('nav.inscripciones')}</a></li>
            </ul>
          </div>

          <!-- Contact -->
          <div>
            <h4 class="text-white font-bold mb-4 uppercase tracking-wider">{t('footer.contact')}</h4>
            <ul class="space-y-2 text-racing-silver">
              <li class="flex items-center gap-2">
                <svg class="w-4 h-4 text-vanilla" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
                </svg>
                info@gripclub.es
              </li>
              <li class="flex items-center gap-2">
                <svg class="w-4 h-4 text-vanilla" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/>
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/>
                </svg>
                España
              </li>
            </ul>
          </div>
        </div>

        <!-- Bottom -->
        <div class="pt-8 border-t border-racing-silver/10 flex flex-col md:flex-row justify-between items-center gap-4">
          <p class="text-racing-silver text-sm">
            &copy; {new Date().getFullYear()} Grip Club. {t('footer.rights')}
          </p>
          <p class="text-racing-silver/50 text-xs">
            {t('footer.inspired')}
          </p>
        </div>
      </div>
    </footer>

    <!-- Mobile Menu Script -->
    <script>
      const mobileMenuBtn = document.getElementById('mobile-menu-btn');
      const mobileMenu = document.getElementById('mobile-menu');

      mobileMenuBtn?.addEventListener('click', () => {
        mobileMenu?.classList.toggle('hidden');
      });
    </script>
  </body>
</html>
